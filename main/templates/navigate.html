{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            color: #fff;
            font-family: "Work Sans", sans-serif;
            background-size: cover;
            background-repeat: no-repeat;
            background-color: black;
            margin: 0;
            padding: 0;
        }

        nav {
            position: absolute;
            left: 80px;
            height: 5vh;
            display: flex;
            align-items: center;
        }

        nav .logo {
            width: 100px;
            height: 100px;
            background: url("{% static 'logo.png' %}") no-repeat center center;
            background-size: contain;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }

        nav ul li {
            display: inline;
        }

        nav ul li a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
        }

        

        .logoutbtn {
            width: 100%;
            align-items: center;
            justify-content: center;
            display: flex;
        }

        .logoutbtn-parent {
            width: 90px;
            position: relative;
            border-radius: 10px;
            background-color: #000;
            box-shadow: 15px 20px 24.8px rgba(77, 36, 243, 0.2) inset, 1px 1px 1.5px rgba(255, 255, 255, 0.3) inset, 3px 4px 9.4px rgba(157, 132, 255, 0.2) inset;
            border: 1px solid rgba(255, 255, 255, 0.236);
            box-sizing: border-box;
            height: 43px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            padding: 10px 0;
            text-align: left;
            font-size: 16px;
            color: #fff;
            cursor: pointer;
        }

        .main-content {
            height: 90vh;
            display: flex;
            margin: 0;
            padding: 0;
        }

        gmp-place-autocomplete::part(input) {
            background-color: #ff0000;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        #generate-routes{
            cursor: pointer;
        }

        #generate-routes:hover{
            box-shadow: 15px 20px 24.8px rgba(77, 36, 243, 0.2) inset, 1px 1px 1.5px rgba(255, 255, 255, 0.3) inset, 3px 4px 9.4px rgba(157, 132, 255, 0.2) inset, -15px -20px 24.8px rgba(77, 36, 243, 0.2) inset, -1px -1px 1.5px rgba(255, 255, 255, 0.3) inset, -3px -4px 9.4px rgba(157, 132, 255, 0.2) inset;
        }

        #full-screen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .spinner{
            animation: rotation 8s infinite linear;
        }

        @keyframes rotation {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(359deg);
            }
        }

        
    </style>
</head>
<body>
    <div style="height: 10vh; margin: 0; width: 100%; display: flex; align-items: center; background-color: #0a0a0a;">
        <nav>
            <div class="logo"></div>
            <h1 style="font-size: 60px;">TransitAssist</h1>
            
        </nav>
        <div style="margin-left:auto;margin-right:80px;height:5vh;display:flex;align-items:center;">
            <form id="logoutForm" action="{% url 'logout' %}" method="post">
                {% csrf_token %}
                <div class="logoutbtn-parent">
                    <div class="logoutbtn" onclick="document.getElementById('logoutForm').submit()">
                        <div>Logout</div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="main-content">
        <div style="width:30%;height:100%;display:flex;align-items: center;flex-direction: column;">
            <div style="width:80%;padding:20px;border-bottom:1px solid rgba(255,255,255,0.15);height: 12vh;display:flex;flex-direction:row;">
                <div id="place-inputs" style="margin-top:30px;width:75%">
                    <h6 style="margin:0px;margin-left:30px;">Origin&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#00ff00">&#11044;</span></h6>
                </div>
                <div id="go-btn-holder" style="width:20%;margin-left:auto;height:100%;display:flex;align-items: end;justify-content: center;">
                    <div id="generate-routes" style="height: 69%;width:96%;margin:0px;border:1px solid white;border-radius: 40px;display: flex;align-items: center;justify-content: center;">
                        <h4>GO</h4>
                    </div>
                </div>
            </div>
            <div id="route-steps" style="width:80%;padding:20px;height:75vh;display: flex;flex-direction: column;">
                <div style="width:100%;padding:20px;box-shadow: 15px 20px 24.8px rgba(77, 36, 243, 0.2) inset, 1px 1px 1.5px rgba(255, 255, 255, 0.3) inset, 3px 4px 9.4px rgba(157, 132, 255, 0.2) inset;border: 1px rgba(255, 255, 255, 0.1);height:fit-content;border-radius: 20px;"></div>
            </div>
        </div>
        <div style="width:70%;height:100%;display:flex;">
            <div id="route-info" style="width:80%;background-color: #18151E;border-radius: 30px;height:7vh;margin-top:40px;display: flex;align-items: center;flex-direction: row;padding:20px;font-size:20px;"><i style="color:gray; font-size: 20px;">Choose a journey on the left</i></div>
            <div id="map" style="width:100%;height:100%;padding: 0;margin: 0;"></div>
        </div>
    </div>
    <div id="full-screen-overlay" style="display: none;" onclick="document.getElementById('close-overlay-btn').click()"></div>
    <div id="loading-overlay" style="display: none;">
        <img class="spinner" src="{% static 'logo.png' %}" style="width:200px;border-radius: 200px;"/>
        <h1 style="font-size:50px;">Loading</h1>
    </div>
    <button id="show-overlay-btn" style="display: none;"></button>
    <button id="close-overlay-btn" style="display:none;"></button>
    <button id="show-loading-btn" style="display: none;"></button>
    <button id="close-loading-btn" style="display:none;"></button>
    <script>(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})
        ({key: "AIzaSyCbZ2QUNhC61wdGwvKkjyTV4M3KkEKtX_E", v: "beta"});</script>
    <script>

        let map;
        let origin;
        let marker1;
        let infoWindow1;
        let destination;
        let marker2;
        let infoWindow2;
        let challenge = false;
        let accessibility = false;
        let autosave = false;
        let directionsService;
        let directionsRenderer;

        function generateHexColor(x, y) {
            var hexColor = "#000000";
            if(challenge){
                if (y === 0) {
                    throw new Error("y cannot be zero");
                }
                let ratio = x / y;
                ratio = Math.max(0, Math.min(1, ratio));
                if(ratio > 0.5){
                    const red = Math.round(255 * (ratio - 0.5));
                    const redHex = red.toString(16).padStart(2, '0');
                    hexColor = `#${redHex}0000`;
                }
                else{
                    const green = Math.round(255 * (1-ratio));
                    const greenHex = green.toString(16).padStart(2, '0');
                    hexColor = `#00${greenHex}00`;
                }
            }
            return hexColor;
        }

        async function reportIssueTransit(sp){
            let problem = prompt("Report an accessibility issue", "No escalator access");
            if (problem == null || problem == "") {
            } else {
                const response3 = await fetch("{% url 'add-issue' %}", {
                    method: "POST",
                    cache: "no-cache",
                    headers: {
                        "Content-Type": "application/json",
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({"places": [sp.dataset.name], "issue": problem}),
                });
                const result3 = await response3.json();
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {

            const showOverlayBtn = document.getElementById('show-overlay-btn');
            const closeOverlayBtn = document.getElementById('close-overlay-btn');
            const fullScreenOverlay = document.getElementById('full-screen-overlay');

            showOverlayBtn.addEventListener('click', () => {
                fullScreenOverlay.style.display = 'flex';
            });

            closeOverlayBtn.addEventListener('click', () => {
                fullScreenOverlay.style.display = 'none';
            });

            const showLoadingBtn = document.getElementById('show-loading-btn');
            const closeLoadingBtn = document.getElementById('close-loading-btn');
            const LoadingOverlay = document.getElementById('loading-overlay');

            showLoadingBtn.addEventListener('click', () => {
                LoadingOverlay.style.display = 'flex';
            });

            closeLoadingBtn.addEventListener('click', () => {
                LoadingOverlay.style.display = 'none';
            });



            const response99 = await fetch("{% url 'get-map-settings' %}", {
                method: "POST",
                cache: "no-cache",
                headers: {
                    "Content-Type": "application/json",
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({}),
            });
            const result99 = await response99.json();
            challenge = result99["challenge"];
            accessibility = result99["accessibility"];
            autosave = result99["autosave"];


            async function initMap() {
                const [{ Map }, { AdvancedMarkerElement, PinElement, Marker }, { PlaceAutocompleteElement }, { Geometry }] = await Promise.all([
                    google.maps.importLibrary("maps"),
                    google.maps.importLibrary("marker"),
                    google.maps.importLibrary("places"),
                    google.maps.importLibrary("geometry"),
                ]);

                directionsService = new google.maps.DirectionsService();
                directionsRenderer = new google.maps.DirectionsRenderer();

                map = new google.maps.Map(document.getElementById("map"), {
                    center: { lat: 40.749933, lng: -73.98633 },
                    zoom: 13,
                    mapId: "4504f8b37365c3d0",
                    mapTypeControl: false,
                });

                directionsRenderer.setMap(map);

                const card = document.getElementById("route-info");
                map.controls[google.maps.ControlPosition.TOP_CENTER].push(card);

                const place1Autocomplete = new google.maps.places.PlaceAutocompleteElement();
                place1Autocomplete.id = "place1-autocomplete-input";
                document.getElementById("place-inputs").appendChild(place1Autocomplete);
                marker1 = new google.maps.Marker({
                    map: map,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 0,
                    },
                });
                infoWindow1 = new google.maps.InfoWindow({});
                place1Autocomplete.addEventListener("gmp-placeselect", async ({ place }) => {
                    await place.fetchFields({
                        fields: ["displayName", "formattedAddress", "location"],
                    });
                    origin = place.toJSON();
                    updateMapAndMarkers();
                });

                const destinationHeader = document.createElement('h6');
                destinationHeader.style = "margin:0px;margin-left:30px;margin-top:30px;";
                destinationHeader.innerHTML = `Destination&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff0000;">&#11044;</span>`;

                document.getElementById("place-inputs").appendChild(destinationHeader);

                const place2Autocomplete = new google.maps.places.PlaceAutocompleteElement();
                place2Autocomplete.id = "place2-autocomplete-input";
                document.getElementById("place-inputs").appendChild(place2Autocomplete);
                marker2 = new google.maps.Marker({
                    map: map,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE, // Set an initial path to avoid the default red pin
                        scale: 0, // Make the initial path invisible
                    },
                });
                infoWindow2 = new google.maps.InfoWindow({});
                place2Autocomplete.addEventListener("gmp-placeselect", async ({ place }) => {
                    await place.fetchFields({
                        fields: ["displayName", "formattedAddress", "location"],
                    });
                    destination = place.toJSON();
                    updateMapAndMarkers();
                });
            }

            function updateMapAndMarkers() {
                let isOrigin = false;
                let isDestination = false;
                if (origin && origin.location) {
                    isOrigin = true;
                    let content1 =
                        '<div id="infowindow-content" style="color:black;">' +
                        '<span id="place-displayname" class="title">' +
                        origin.displayName +
                        "</span><br />" +
                        '<span id="place-address">' +
                        origin.formattedAddress +
                        "</span>" +
                        "</div>";
                    updateInfoWindow(infoWindow1, content1, origin.location, marker1);
                    marker1.setPosition(origin.location);
                    marker1.setIcon({path: google.maps.SymbolPath.CIRCLE, scale: 10, fillColor: "#00ff00", fillOpacity: 1, strokeWeight: 0.8});
                    marker1.setMap(map);
                }

                if (destination && destination.location) {
                    isDestination = true;
                    let content2 =
                        '<div id="infowindow-content" style="color:black;">' +
                        '<span id="place-displayname" class="title">' +
                        destination.displayName +
                        "</span><br />" +
                        '<span id="place-address">' +
                        destination.formattedAddress +
                        "</span>" +
                        "</div>";
                    updateInfoWindow(infoWindow2, content2, destination.location, marker2);
                    marker2.setPosition(destination.location);
                    marker2.setIcon({path: google.maps.SymbolPath.CIRCLE, scale: 10, fillColor: "#ff0000", fillOpacity: 1, strokeWeight: 0.8});
                    marker2.setMap(map);
                }

                // Adjust the map to fit both markers if both places are selected.
                if (isOrigin && isDestination) {
                    const bounds = new google.maps.LatLngBounds();
                    bounds.extend(origin.location);
                    bounds.extend(destination.location);
                    map.fitBounds(bounds);
                } else if (isOrigin) {
                    map.setCenter(origin.location);
                    map.setZoom(17);
                } else if (isDestination) {
                    map.setCenter(destination.location);
                    map.setZoom(17);
                }
            }

            function updateInfoWindow(infoWindow, content, center, marker) {
                infoWindow.setContent(content);
                infoWindow.setPosition(center);
                infoWindow.open({
                    map,
                    anchor: marker,
                    shouldFocus: false,
                });
            }

            initMap();

            async function generateRoutes() {
                if (!(origin && origin.location && destination && destination.location)) {
                    alert("Please select two places to generate routes.");
                    return;
                }

                showLoadingBtn.click();

                const response199 = await fetch("{% url 'get-map-settings' %}", {
                    method: "POST",
                    cache: "no-cache",
                    headers: {
                        "Content-Type": "application/json",
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({}),
                });
                const result199 = await response199.json();
                challenge = result199["challenge"];
                accessibility = result199["accessibility"];
                autosave = result199["autosave"];


                let request = {
                    origin: origin.location,
                    destination: destination.location,
                    travelMode: 'TRANSIT',
                    provideRouteAlternatives: true,
                    transitOptions: {
                        routingPreference: 'LESS_WALKING'
                    }
                };

                directionsService.route(request, async function(result, status) {
                    if (status == 'OK') {
                        const response = await fetch("{% url 'save-route' %}", {
                            method: "POST",
                            cache: "no-cache",
                            headers: {
                                "Content-Type": "application/json",
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            body: JSON.stringify({"start": origin.displayName, "end": destination.displayName}),
                        });
                        const result2 = await response.json();
                        displayRoutes(result);
                    } else {
                        alert('Could not generate routes: ' + status);
                    }
                });

            }

            document.getElementById("generate-routes").addEventListener('click', () => {
                generateRoutes();
            });

            async function processRoutes(res){
                let initialRouteList = JSON.parse(JSON.stringify(res.routes));
                for(var i=0;i<initialRouteList.length;i++){
                    let currRoute = initialRouteList[i];
                    currRoute.numIssues = 0;
                    currRoute.numSuccesses = 0;
                    currRoute.totalSteps = 0;
                    let mainInfo = currRoute.legs[0];
                    for(var j=0;j<mainInfo.steps.length;j++){
                        let currStep = mainInfo.steps[j];
                        if(currStep.travel_mode == "WALKING"){
                            for(var k=0;k<currStep.steps.length;k++){
                                let currPart = currStep.steps[k];
                                currPart.ids = [];
                                const response1 = await fetch(`https://api.geoapify.com/v1/geocode/reverse?lat=${currPart.start_location.lat}&lon=${currPart.start_location.lng}&type=street&lang=en&limit=1&format=json&apiKey=95be0cf25e324f7f998ceccffb5364c0`);
                                const result1 = await response1.json();
                                currPart.ids.push(result1.results[0].place_id);
                                const response2 = await fetch(`https://api.geoapify.com/v1/geocode/reverse?lat=${currPart.end_location.lat}&lon=${currPart.end_location.lng}&type=street&lang=en&limit=1&format=json&apiKey=95be0cf25e324f7f998ceccffb5364c0`);
                                const result2 = await response2.json();
                                currPart.ids.push(result2.results[0].place_id);
                                const response3 = await fetch("{% url 'get-issues' %}", {
                                    method: "POST",
                                    cache: "no-cache",
                                    headers: {
                                        "Content-Type": "application/json",
                                        'X-CSRFToken': '{{ csrf_token }}'
                                    },
                                    body: JSON.stringify({"places": currPart.ids}),
                                });
                                const result3 = await response3.json();
                                currPart.issues = result3["data"];
                                const response4 = await fetch("{% url 'get-goods' %}", {
                                    method: "POST",
                                    cache: "no-cache",
                                    headers: {
                                        "Content-Type": "application/json",
                                        'X-CSRFToken': '{{ csrf_token }}'
                                    },
                                    body: JSON.stringify({"places": currPart.ids}),
                                });
                                const result4 = await response4.json();
                                currPart.successes = result4["data"];
                                if(currPart.issues.length > 0){
                                    currRoute.numIssues += 1;
                                }
                                if(currPart.successes.length > 0){
                                    currRoute.numSuccesses += 1;
                                }
                                currRoute.totalSteps += 1;
                            }
                        }
                        else{
                            currStep.ids = [currStep.transit.departure_stop.name + " ||| " + currStep.transit.line.agencies[0].name, currStep.transit.arrival_stop.name + " ||| " + currStep.transit.line.agencies[0].name];
                            const response1 = await fetch("{% url 'get-issues' %}", {
                                method: "POST",
                                cache: "no-cache",
                                headers: {
                                    "Content-Type": "application/json",
                                    'X-CSRFToken': '{{ csrf_token }}'
                                },
                                body: JSON.stringify({"places": [currStep.ids[0]]}),
                            });
                            const result1 = await response1.json();
                            const response2 = await fetch("{% url 'get-issues' %}", {
                                method: "POST",
                                cache: "no-cache",
                                headers: {
                                    "Content-Type": "application/json",
                                    'X-CSRFToken': '{{ csrf_token }}'
                                },
                                body: JSON.stringify({"places": [currStep.ids[1]]}),
                            });
                            const result2 = await response2.json();
                            currStep.issues = [result1["data"], result2["data"]];
                            const response3 = await fetch("{% url 'get-goods' %}", {
                                method: "POST",
                                cache: "no-cache",
                                headers: {
                                    "Content-Type": "application/json",
                                    'X-CSRFToken': '{{ csrf_token }}'
                                },
                                body: JSON.stringify({"places": [currStep.ids[0]]}),
                            });
                            const result3 = await response3.json();
                            const response4 = await fetch("{% url 'get-goods' %}", {
                                method: "POST",
                                cache: "no-cache",
                                headers: {
                                    "Content-Type": "application/json",
                                    'X-CSRFToken': '{{ csrf_token }}'
                                },
                                body: JSON.stringify({"places": [currStep.ids[1]]}),
                            });
                            const result4 = await response4.json();
                            currStep.successes = [result3["data"], result4["data"]];
                            if(currStep.issues[0].length > 0 || currStep.issues[1].length > 0){
                                currRoute.numIssues += 1;
                            }
                            if(currStep.successes[0].length > 0 || currStep.successes[1].length > 0){
                                currRoute.numSuccesses += 1;
                            }
                            currRoute.totalSteps += 1;
                        }
                    }
                }
                if(accessibility){
                    initialRouteList.sort(function(x, y) {
                        return x.numIssues - y.numIssues + 0.5*(y.numSuccesses - x.numSuccesses);
                    });
                }
                return initialRouteList;

            }

            async function displayRoutes(res){
                try {
                    map.directionsRenderers.forEach((r, i) => {
                        r.setMap(null);
                    });
                } catch {
                }
                map.directionsRenderers = [];
                routes = await processRoutes(res);
                routes.forEach((route, index) => {
                    const renderer = new google.maps.DirectionsRenderer({
                        map: map,
                        directions: res,
                        routeIndex: index,
                        polylineOptions: {
                            strokeColor: generateHexColor(route.numIssues, route.totalSteps), // Highlight the best route in blue, others in grey
                            strokeOpacity: 1,
                            strokeWeight: 6,
                        },
                        suppressMarkers: true, // Suppress the default markers
                    });

                    // Store each renderer in the map's renderers array
                    map.directionsRenderers.push(renderer);
                });
                let routeDivs = [];
                if(routes.length == 1){
                    let routeDiv = document.createElement('div');
                    routeDiv.style = style="cursor: pointer; width: 65%; height: 12vh; background-color: rgb(24, 21, 30); border: 0px; border-radius: 30px 30px 0px 0px; display: flex; flex-direction: row;";
                    routeDiv.classList.add("route-selection-div");

                    routeDivs = [routeDiv];
                }
                else{
                    for(var i=0;i<routes.length;i++){
                        let routeDiv = document.createElement('div');
                        routeDiv.classList.add("route-selection-div");
                        if(i == 0){
                            routeDiv.style = "cursor:pointer;width:60%;height:10vh;background-color: #18151E;border: 1px solid rgba(255, 255, 255, 0.2);border-radius:30px 30px 0 0;border-bottom:1px solid rgba(255,255,255,0.15);display:flex;flex-direction:row;";
                        }
                        else if(i == routes.length - 1){
                            routeDiv.style = "cursor:pointer;width:60%;height:10vh;background-color: #18151E;border: 1px solid rgba(255, 255, 255, 0.2);border-radius:0 0 30px 30px;border-top:0;display:flex;flex-direction:row;";
                        }
                        else{
                            routeDiv.style = "cursor:pointer;width:60%;height:10vh;background-color: #18151E;border: 1px solid rgba(255, 255, 255, 0.2);border-bottom:1px solid rgba(255,255,255,0.15);border-top:0;display:flex;flex-direction:row;";
                        }
                        
                        routeDivs.push(routeDiv);
                        
                    }
                }
                document.getElementById("full-screen-overlay").innerHTML = "";
                for(var i=0; i<routeDivs.length; i++){
                    document.getElementById("full-screen-overlay").appendChild(routeDivs[i]);
                    let startTimeDiv = document.createElement('div');
                    startTimeDiv.style = "width: 25%; height: 100%; display: flex; flex-direction: column; padding-left: 50px;justify-content:center;";
                    startTimeDiv.innerHTML = `<div><p>Start time</p><p>${routes[i].legs[0].departure_time.text}</p></div>`;
                    routeDivs[i].appendChild(startTimeDiv);
                    let endTimeDiv = document.createElement('div');
                    endTimeDiv.style = "width: 25%; height: 100%; display: flex; flex-direction: column; padding-left: 50px;justify-content:center;";
                    endTimeDiv.innerHTML = `<div><p>End time</p><p>${routes[i].legs[0].arrival_time.text}</p></div>`;
                    routeDivs[i].appendChild(endTimeDiv);
                    let inaccessibilitiesDiv = document.createElement('div');
                    inaccessibilitiesDiv.style = "width: 25%; height: 100%; display: flex; flex-direction: column; padding-left: 50px;justify-content:center;";
                    inaccessibilitiesDiv.innerHTML = `<div><p>Inaccessibilities</p><p>${routes[i].numIssues}</p></div>`;
                    routeDivs[i].appendChild(inaccessibilitiesDiv);
                    let accessibilitiesDiv = document.createElement('div');
                    accessibilitiesDiv.style = "width: 25%; height: 100%; display: flex; flex-direction: column; padding-left: 50px;justify-content:center;";
                    accessibilitiesDiv.innerHTML = `<div><p>Accessibilities</p><p>${routes[i].numSuccesses}</p></div>`;
                    routeDivs[i].appendChild(accessibilitiesDiv);
                    routeDivs[i].dataset.routeId = i;
                    routeDivs[i].addEventListener('mouseover', function () {
                        this.style.backgroundColor = "#000";
                    });
                    routeDivs[i].addEventListener('mouseout', function () {
                        this.style.backgroundColor = "#18151E";
                    });
                    routeDivs[i].addEventListener('click', function(){
                        let routeId = this.dataset.routeId;
                        for(var j=0; j<routeDivs.length; j++){
                            if(j == routeId){
                                routeDivs[j].style.border = "2px solid rgba(255,255,255,0.4)";
                            }
                            else{
                                routeDivs[j].style.border = "0";
                            }
                            if(j != routeDivs.length - 1 && j != routeId){
                                routeDivs[j].style.borderBottom = "1px solid rgba(255,255,255,0.15)";
                            }
                        }
                        route = routes[routeId];
                        document.getElementById("route-info").innerHTML = "";
                        let startTimeDiv = document.createElement('div');
                        startTimeDiv.style = "width:20%;height:100%;display:flex;flex-direction:column;padding-left:20px;justify-content:center;";
                        startTimeDiv.innerHTML = `<div><p style="color:rgba(255,255,255,0.5)">Start time</p><p>${route.legs[0].departure_time.text}</p></div>`;
                        document.getElementById("route-info").appendChild(startTimeDiv);
                        let endTimeDiv = document.createElement('div');
                        endTimeDiv.style = "width:20%;height:100%;display:flex;flex-direction:column;padding-left:20px;justify-content:center;";
                        endTimeDiv.innerHTML = `<div><p style="color:rgba(255,255,255,0.5)">End time</p><p>${route.legs[0].arrival_time.text}</p></div>`;
                        document.getElementById("route-info").appendChild(endTimeDiv);
                        let inaccessibilitiesDiv = document.createElement('div');
                        inaccessibilitiesDiv.style = "width:20%;height:100%;display:flex;flex-direction:column;padding-left:20px;justify-content:center;";
                        inaccessibilitiesDiv.innerHTML = `<div><p style="color:rgba(255,255,255,0.5)">Inaccessibilities</p><p>${route.numIssues}</p></div>`;
                        document.getElementById("route-info").appendChild(inaccessibilitiesDiv);
                        let accessibilitiesDiv = document.createElement('div');
                        accessibilitiesDiv.style = "width:20%;height:100%;display:flex;flex-direction:column;padding-left:20px;justify-content:center;";
                        accessibilitiesDiv.innerHTML = `<div><p style="color:rgba(255,255,255,0.5)">Accessibilities</p><p>${route.numSuccesses}</p></div>`;
                        document.getElementById("route-info").appendChild(accessibilitiesDiv);
                        let changeRouteDiv = document.createElement('div');
                        changeRouteDiv.style = "width:20%;height:100%;display:flex;flex-direction:column;padding-left:20px;padding-right:20px;align-items:center;justify-content:center;";
                        changeRouteDiv.innerHTML = `<button style="cursor:pointer;font-size:18px;width:80%;height:80%;background-color:#282530;border-radius:40px;border:1px solid rgba(255,255,255,0.1);color:white;" onclick='document.getElementById("show-overlay-btn").click();'>Change route</button>`;
                        document.getElementById("route-info").appendChild(changeRouteDiv);
                        for(var j=0;j<map.directionsRenderers.length;j++){
                            if(j == routeId){
                                map.directionsRenderers[j].setMap(map);
                            }
                            else{
                                map.directionsRenderers[j].setMap(null);
                            }
                        }
                    })
                }
                closeLoadingBtn.click();
                document.getElementById("show-overlay-btn").click();
                
            }
        });
    </script>
</body>
</html>
